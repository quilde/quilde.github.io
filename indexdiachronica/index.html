<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Index Diachronica Database</title>
</head>
<body>
  
  <h1>(WIP please check back later)</h1>
  <div id=renderedRule class=render>
  </div>
  
  <style>
  * {
      font-family: 'Noto Serif';
  }
  
  </style>
  
  <script>
  /*
var renderRule = rule => `
   ${rule.be} â†’ ${rule.af} ${rule.en ? '/ ' + rule.en : ''}
`; */

var render = (data) => {
  
  logJSON();
  //document.querySelector('#renderedRule').innerHTML = renderRule(data);
  //document.querySelector('#renderedChangeset').innerHTML = changeset.changeset.map(renderRule).join('');
}
/*
var listen = () => { 
  var renderedRule = document.querySelector('#renderedRule');
  var ruleTA = document.querySelector('#sampleRule textarea');
  var ruleText = JSON.parse(ruleTA.value);

  ruleTA.addEventListener('input', render);
  ruleTA.addEventListener('change', render);
  render();
}

listen();
*/
render();
async function logJSON() {
  /*const response = await fetch("https://quilde.github.io/indexdiachronica/index.json/");
  const movies = await response.json();
  console.log(movies);
  return movies;*/
  const response = await fetch("https://quilde.github.io/indexdiachronica/index/afroasiatic/afroasiatic.json");
  const data = await response.json();
  console.log(data);
  const renderRules = rule => `
  ${rule.before} > ${rule.after} ${rule.env ? '/ ' + rule.env : ''} \r\n
   
`;
  const renderNotes = rule => `
  ${rule} \r\n
   
`;
  
  console.log(data.changesets.length);
  for(let j = 0; j< data.changesets.length; j++) {
        var card = document.createElement("h2");
        card.innerHTML = `${data.changesets[j].metadata.parent} to ${data.changesets[j].metadata.child}  `;
        document.querySelector('#renderedRule').appendChild(card);
        var note = document.createElement("blockquote");
        note.innerHTML = `${data.changesets[j].metadata.note.map(renderNotes) }  `;
        document.querySelector('#renderedRule').appendChild(note);
        for (let i = 0; i < data.changesets[j].changeset.length; i++) {
            var card = document.createElement("p");
            let rule = data.changesets[j].changeset[i];
            card.innerHTML = `${rule.before} > ${rule.after} ${rule.env ? '/ ' + rule.env : ''} ${rule.note[0]}`;
            console.log(data.changesets[j].changeset[i]);
            document.querySelector('#renderedRule').appendChild(card);
  }
  }
  
}


</script>
</body>
</html>
